{% extends "student_base.html" %}

{% block title %}–ê–Ω–∞–ª–∏—Ç–∏–∫–∞ - –£—á–µ–Ω–∏–∫{% endblock %}
{% block page_title %}–ê–Ω–∞–ª–∏–∑ –≤–∞—à–∏—Ö —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤{% endblock %}

{% block content %}
<div class="row">
    <div class="col-12">
        <div class="card shadow-sm border-0 rounded-4 mb-4">
            <div class="card-body p-4">
                <h3 class="fw-bold mb-4"> üìà –û–±—â–∏–π –ø—Ä–æ–≥—Ä–µ—Å—Å</h3>
                {% if analysis %}
                    <div class="row">
                        <div class="col-md-6">
                            <div class="card bg-light border-0 rounded-3 p-3 mb-3">
                                <h5>–í—Ö–æ–¥–Ω–æ–π –∫–æ–Ω—Ç—Ä–æ–ª—å</h5>
                                <div class="progress" style="height: 30px;">
                                    <div class="progress-bar" role="progressbar" 
                                         style="width: {{ initial_percentage }}%; background-color: #6c757d;" 
                                         aria-valuenow="{{ initial_percentage }}" 
                                         aria-valuemin="0" 
                                         aria-valuemax="100">
                                        {{ "%.1f"|format(initial_percentage) }}%
                                    </div>
                                </div>
                            </div>
                        </div>
                        <div class="col-md-6">
                            <div class="card bg-light border-0 rounded-3 p-3 mb-3">
                                <h5>–í—ã—Ö–æ–¥–Ω–æ–π –∫–æ–Ω—Ç—Ä–æ–ª—å</h5>
                                <div class="progress" style="height: 30px;">
                                    <div class="progress-bar" role="progressbar" 
                                         style="width: {{ final_percentage }}%; background-color: #198754;" 
                                         aria-valuenow="{{ final_percentage }}" 
                                         aria-valuemin="0" 
                                         aria-valuemax="100">
                                        {{ "%.1f"|format(final_percentage) }}%
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                    
                    <div class="alert {{ 'alert-success' if analysis.percentage_difference > 0 else 'alert-warning' }}">
                        <h4><i class="bi {{ 'bi-graph-up-arrow' if analysis.percentage_difference > 0 else 'bi-graph-down-arrow' }} me-2"></i> 
                        –ò–∑–º–µ–Ω–µ–Ω–∏–µ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–∞: {{ "%.1f"|format(analysis.percentage_difference) }}%</h4>
                        {% if analysis.percentage_difference > 0 %}
                            <p class="mb-0">–í—ã –ø–æ–∫–∞–∑–∞–ª–∏ –æ—Ç–ª–∏—á–Ω—ã–π –ø—Ä–æ–≥—Ä–µ—Å—Å –≤ –æ–±—É—á–µ–Ω–∏–∏!</p>
                        {% else %}
                            <p class="mb-0">–ù–µ–∫–æ—Ç–æ—Ä—ã–µ —Ç–µ–º—ã —Ç—Ä–µ–±—É—é—Ç –¥–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω–æ–≥–æ –≤–Ω–∏–º–∞–Ω–∏—è.</p>
                        {% endif %}
                    </div>
                    
                    <h4 class="mt-4 mb-3">üß© –î–µ—Ç–∞–ª—å–Ω—ã–π –∞–Ω–∞–ª–∏–∑ –ø–æ —Ç–µ–º–∞–º</h4>
                    <div class="table-responsive">
                        <table class="table table-bordered">
                            <thead class="table-light">
                                <tr>
                                    <th>–¢–µ–º–∞</th>
                                    <th>–í—Ö–æ–¥–Ω–æ–π –∫–æ–Ω—Ç—Ä–æ–ª—å</th>
                                    <th>–í—ã—Ö–æ–¥–Ω–æ–π –∫–æ–Ω—Ç—Ä–æ–ª—å</th>
                                    <th>–ò–∑–º–µ–Ω–µ–Ω–∏–µ</th>
                                    <th>–ê–Ω–∞–ª–∏–∑</th>
                                </tr>
                            </thead>
                            <tbody>
                                {% for category in categories_analysis %}
                                <tr>
                                    <td>{{ category.name }}</td>
                                    <td>{{ "%.1f"|format(category.initial_score) }}%</td>
                                    <td>{{ "%.1f"|format(category.final_score) }}%</td>
                                    <td class="{{ 'text-success' if category.progress > 0 else 'text-danger' }}">
                                        {{ "%+.1f"|format(category.progress) }}%
                                    </td>
                                    <td>{{ category.analysis }}</td>
                                </tr>
                                {% endfor %}
                            </tbody>
                        </table>
                    
                        <h4 class="mt-4 mb-3">üìù –ü–æ–¥—Ä–æ–±–Ω—ã–π –∞–Ω–∞–ª–∏–∑ –æ—à–∏–±–æ–∫</h4>
                        <div class="card border-0 bg-light">
                            <div class="card-body">
                                {{ analysis.analysis_text.replace('\n', '<br>')|safe }}
                            </div>
                        </div>
                    {% else %}
                        <div class="alert alert-info">
                            <h4><i class="bi bi-info-circle me-2"></i> –î–∞–Ω–Ω—ã–µ –∞–Ω–∞–ª–∏–∑–∞ –ø–æ–∫–∞ –Ω–µ–¥–æ—Å—Ç—É–ø–Ω—ã</h4>
                            <p class="mb-0">–î–ª—è –ø—Ä–æ—Å–º–æ—Ç—Ä–∞ –∞–Ω–∞–ª–∏—Ç–∏–∫–∏ –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ –∑–∞–≤–µ—Ä—à–∏—Ç—å –æ–±—É—á–µ–Ω–∏–µ –∏ –ø—Ä–æ–π—Ç–∏ –≤—ã—Ö–æ–¥–Ω–æ–π –∫–æ–Ω—Ç—Ä–æ–ª—å –∑–Ω–∞–Ω–∏–π.</p>
                        </div>
                    {% endif %}
                </div>
            </div>
        </div>
    </div>
</div>
{% endblock %}
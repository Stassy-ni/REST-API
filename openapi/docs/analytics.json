{
  "openapi": "3.0.3",
  "info": {
    "title": "Math Learning Platform API",
    "version": "1.0.0",
    "description": "Спецификация REST API для модуля выдачи и аналитики заданий."
  },
  "servers": [
    {
      "url": "https://api.mathplatform.example.com/v1",
      "description": "Production"
    }
  ],
  "tags":[
    {"name":"Analytics - Прогресс ученика","description":"Прогресс и успеваемость по темам"},
    {"name":"Analytics - Активность","description":"История действий ученика"},
    {"name":"Analytics - Рейтинг и достижения","description":"Очки, бейджи, ранги, MVP-отметки"}
  ],
  "paths":{
    "/learning-progress/{student_id}":{
      "get":{
        "tags":["Analytics - Прогресс ученика"],
        "summary":"Прогресс ученика по темам",
        "security":[{"BearerAuth":[]}],
        "parameters":[
          {"name":"student_id","in":"path","required":true,"schema":{"type":"integer"}},
          {"name":"limit","in":"query","schema":{"type":"integer","default":20}},
          {"name":"offset","in":"query","schema":{"type":"integer","default":0}}
        ],
        "responses":{"200":{"description":"Прогресс по темам","content":{"application/json":{"schema":{"type":"object","properties":{"count":{"type":"integer"},"next":{"type":"string","format":"uri","nullable":true},"previous":{"type":"string","format":"uri","nullable":true},"results":{"type":"array","items":{"$ref":"#/components/schemas/Analytics.LearningProgress"}}}}}}}}
      }
    },
    "/activity-log/{student_id}":{
      "get":{
        "tags":["Analytics - Активность"],
        "summary":"История активности ученика",
        "security":[{"BearerAuth":[]}],
        "parameters":[
          {"name":"student_id","in":"path","required":true,"schema":{"type":"integer"}},
          {"name":"action_type","in":"query","schema":{"type":"string"}},
          {"name":"entity_type","in":"query","schema":{"type":"string"}},
          {"name":"limit","in":"query","schema":{"type":"integer","default":20}},
          {"name":"offset","in":"query","schema":{"type":"integer","default":0}}
        ],
        "responses":{"200":{"description":"Лог активности","content":{"application/json":{"schema":{"type":"object","properties":{"count":{"type":"integer"},"next":{"type":"string","format":"uri","nullable":true},"previous":{"type":"string","format":"uri","nullable":true},"results":{"type":"array","items":{"$ref":"#/components/schemas/Analytics.ActivityLogEntry"}}}}}}}}
      }
    },
    "/experience-points/{student_id}":{
      "get":{
        "tags":["Analytics - Рейтинг и достижения"],
        "summary":"Просмотр очков опыта ученика",
        "security":[{"BearerAuth":[]}],
        "parameters":[{"name":"student_id","in":"path","required":true,"schema":{"type":"integer"}}],
        "responses":{"200":{"description":"Очки опыта","content":{"application/json":{"schema":{"type":"array","items":{"$ref":"#/components/schemas/Analytics.ExperiencePointsEntry"}}}}}}
      }
    },
    "/badges/{student_id}":{
      "get":{
        "tags":["Analytics - Рейтинг и достижения"],
        "summary":"Получить бейджи ученика",
        "security":[{"BearerAuth":[]}],
        "parameters":[{"name":"student_id","in":"path","required":true,"schema":{"type":"integer"}}],
        "responses":{"200":{"description":"Список бейджей","content":{"application/json":{"schema":{"type":"array","items":{"$ref":"#/components/schemas/Analytics.BadgeEntry"}}}}}}
      }
    },
    "/ranks/{student_id}":{
      "get":{
        "tags":["Analytics - Рейтинг и достижения"],
        "summary":"Получить ранги ученика",
        "security":[{"BearerAuth":[]}],
        "parameters":[{"name":"student_id","in":"path","required":true,"schema":{"type":"integer"}}],
        "responses":{"200":{"description":"Список рангов","content":{"application/json":{"schema":{"type":"array","items":{"$ref":"#/components/schemas/Analytics.RankEntry"}}}}}}
      }
    },
    "/mvp-tags/{student_id}":{
      "get":{
        "tags":["Analytics - Рейтинг и достижения"],
        "summary":"Получить MVP-отметки ученика",
        "security":[{"BearerAuth":[]}],
        "parameters":[{"name":"student_id","in":"path","required":true,"schema":{"type":"integer"}},{"name":"assignment_task_id","in":"query","schema":{"type":"integer"}}],
        "responses":{"200":{"description":"Список MVP-отметок","content":{"application/json":{"schema":{"type":"array","items":{"$ref":"#/components/schemas/Analytics.MVPTagEntry"}}}}}}
      }
    }
  },
  "components":{
      "securitySchemes": {
        "BearerAuth": {
          "type": "http",
          "scheme": "bearer",
          "bearerFormat": "JWT"
        }
      },
    "schemas":{
      "Analytics.LearningProgress":{"type":"object","properties":{"topic_id":{"type":"integer"},"topic_title":{"type":"string"},"progress_percent":{"type":"number"},"last_updated":{"type":"string","format":"date-time"}}},
      "Analytics.ActivityLogEntry":{"type":"object","properties":{"id":{"type":"integer"},"action_type":{"type":"string"},"entity_type":{"type":"string"},"assignment_task_id":{"type":"integer"},"topic_id":{"type":"integer"},"task_submission_id":{"type":"integer"},"timestamp":{"type":"string","format":"date-time"}}},
      "Analytics.ExperiencePointsEntry":{"type":"object","properties":{"id":{"type":"integer"},"points":{"type":"integer"},"reason":{"type":"string"},"related_entity_type":{"type":"string"},"assignment_task_id":{"type":"integer"},"topic_id":{"type":"integer"},"task_submission_id":{"type":"integer"},"awarded_at":{"type":"string","format":"date-time"}}},
      "Analytics.BadgeEntry":{"type":"object","properties":{"id":{"type":"integer"},"badge_type":{"type":"string"},"awarded_at":{"type":"string","format":"date-time"}}},
      "Analytics.RankEntry":{"type":"object","properties":{"id":{"type":"integer"},"rank_name":{"type":"string"},"awarded_at":{"type":"string","format":"date-time"}}},
      "Analytics.MVPTagEntry":{"type":"object","properties":{"id":{"type":"integer"},"assignment_task_id":{"type":"integer"},"timestamp":{"type":"string","format":"date-time"}}}
    }
  }
}
